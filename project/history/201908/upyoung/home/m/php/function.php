<?php
//===========================================================================
//DESCRIPTION: 後端管理系統 基本模組
//
//Author: 陳俊全 ZENKI <e10089@yahoo.com.tw>
//File : function.php
//
//Last modified: 2016-3-20
//===========================================================================
function decide_online( $values, $vif=0 ){if( $values=='' || $values==0 || $values==null ){if( $vif==2 ){die('<meta http-equiv="refresh" content="0;URL=index.php">');}if( $vif==1 ){die('error');}else{die('<script language="javascript">
<!--
window.parent.time_out(1);
//-->
</script>');}}}function page_out( $vlink, $vpage, $pagenum, $pageg, $page_num, $vif=false ){$page_s=1;$page_e=0;global $page_total;if( $pageg<$pagenum ){$page_s=$vpage-floor(($pageg-1)/2);$page_e=$vpage+ceil(($pageg-1)/2);if( $page_s<1 ){$page_e+=(1-$page_s);$page_s=1;}else if( $pagenum<$page_e ){$page_s=$page_s-($page_e-$pagenum);$page_e=$pagenum;}}else{$page_s=1;$page_e=$pagenum;}if( $page_s!=0 && $page_e!=0 && $vpage>0 && $pagenum>0 && $pageg>0 ){echo '<table class="cpage"><tr>';if( $page_s!=1 ){echo '<td><a onclick="click_page(\''.$vlink.'&spaget='.$page_total.'\',1);">首頁</a></td>';}for($i=$page_s;$i<=$page_e;$i++){if( $i==$vpage ){echo '<td><font>'.$i.'</font></td>';}else{echo '<td><a onclick="click_page(\''.$vlink.'&spaget='.$page_total.'\','.$i.');">'.$i.'</a></td>';}}if( $page_e!=$pagenum ){echo '<td><a onclick="click_page(\''.$vlink.'&spaget='.$page_total.'\','.$pagenum.');">尾頁</a></td>';}$pt1=$pt2=$pt3=$pt4=$pt5=$pt6=$pt7='';switch ($page_total){case 15;$pt2='selected';break;case 20;$pt3='selected';break;case 30;$pt4='selected';break;case 40;$pt5='selected';break;case 50;$pt6='selected';break;case 100;$pt7='selected';break;default;$pt1='selected';break;}echo '<td>，一頁 <select id="spaget" name="spaget" onchange="click_page(\''.$vlink.'&spaget=\'+$(this).val(),1)"><option '.$pt1.'>10</option><option '.$pt2.'>15</option><option '.$pt3.'>20</option><option '.$pt4.'>30</option><option '.$pt5.'>40</option><option '.$pt6.'>50</option><option '.$pt7.'>100</option></select> 筆，共 '.$page_num.' 筆</td></tr></table>';}}function De_CSA( $str ){$aChars = array('&','\'','<','>');$aVerChars = array('&amp;','&quot;','&lt;','&gt;');if( class_exists('ereg_replace') ){for( $k=0; $k < count($aChars); $k++ ){$str = ereg_replace($aChars[$k], $aVerChars[$k], $str);}}else{for( $k=0; $k < count($aChars); $k++ ){$str = str_replace($aChars[$k], $aVerChars[$k], $str);}}$str = addslashes($str);return $str;}function authority_out( $now_id ){global $mlist, $medit, $madd, $mdele, $DB_common, $table_authority;if( $_SESSION['user_card'][3]==0 ){$mlist=1;$medit=1;$madd=1;$mdele=1;}else{$sql='select mlist, medit, madd, mdele from '.$table_authority.' where tid=\''.$now_id.'\' and gid=\''.$_SESSION['user_card'][2].'\' ';$result=new mysql;$result->connection($DB_common);$result->SQLrequest($sql);$count=$result->RowNum();if( $count>0 ){$record=$result->RowArray();$mlist=$record['mlist'];$medit=$record['medit'];$madd=$record['madd'];$mdele=$record['mdele'];}}}function button_show( $type, $auth_num, $vlink, $vstr='刪除' ){if( $type==1 ){if( $auth_num ){return '<a href="'.$vlink.'" title="新增資料" class="edit_button mouse_over thickbox">新增</a>';}else{return '<a title="新增資料" class="edit_button mouse_over disable_button">新增</a>';}}else if( $type==2 ){if( $auth_num ){return '<a href="'.$vlink.'" title="資料修改" class="edit_button mouse_over thickbox">修改</a>';}else{return '<a title="資料修改" class="edit_button mouse_over disable_button">修改</a>';}}else if( $type==3 ){if( $auth_num ){return '<a href="'.$vlink.'" title="詳細資料" class="edit_button mouse_over thickbox">詳細</a>';}else{return '<a title="詳細資料" class="edit_button mouse_over disable_button">詳細</a>';}}else{if( $auth_num ){return '<font class="edit_button mouse_over" onclick="'.$vlink.'">'.$vstr.'</font>';}else{return '<font class="edit_button mouse_over disable_button">'.$vstr.'</font>';}}}
function select_show( $a, $b, $c, $d, $e=array('啟用','停用','刪除') ){$select_str='<select id="useid" name="useid">';$select_str.='<option value="0">選擇功能</option>';if( $b==1 ){$select_str.='<option value="1"';if( $c==0 ){$select_str.=' disabled="disabled"';}$select_str.='>'.$e[0].'</option>';$select_str.='<option value="2"';if( $c==0 ){$select_str.=' disabled="disabled"';}$select_str.='>'.$e[1].'</option>';}$select_str.='<option value="3"';if( $d==0 ){$select_str.=' disabled="disabled"';}$select_str.='>'.$e[2].'</option>';$select_str.='</select> <font class="mouse_over" onclick="select_run(\''.$a.'\');" >執行</font>';return $select_str;}function show_file_photo( $a, $b, $c, $d, $e, $f, $g=0, $h=0 ){$sa='';switch ($c){case 1:$sa='請選取圖片:<input id="mfile" name="mfile['.$f.']" type="file" onchange="upload_image_preview(this,\'div_'.$a.'\',\'show_'.$a.'\','.$g.','.$h.');"><input type="hidden" id="oldfile" name="oldfile[]" value="'.$b.'"><input type="hidden" id="oldfileaname" name="oldfileaname[]" value=""> '.$e.'<br>';$sa.='預覽:<div id="div_'.$a.'" class="span_image_preview">';$sa.='<img id="show_'.$a.'" name="show_'.$a.'" class="simage" ';if( $b!='' ){$sa.='src="'.$d.$b.'" width="'.$g.'" height="'.$h.'"';}$sa.='></div>';if( $b!='' ){$sa.='<font class="mouse_over" onclick="deleimg(\''.$a.'\');">刪除圖片</font>&nbsp;&nbsp;&nbsp;';}$sa.='<font class="mouse_over" onclick="document.cform1.mfile';if( $f!=='' ){$sa.='['.$f.']';}$sa.='.outerHTML=\'<input id=mfile name=mfile['.$f.'] type=file onchange=upload_image_preview(this,\\\'div_'.$a.'\\\',\\\'show_'.$a.'\\\','.$g.','.$h.')>\';$(\'#show_'.$a.'\')[0].src=\'';if( $b!='' ){$sa.=$d.$b;}$sa.='\';">取消上傳</font>';break;case 2:$sa.='請選取檔案:<input id="mfile" name="mfile['.$f.']" type="file"><input type="hidden" id="oldfile" name="oldfile[]" value="'.$b.'"><input type="hidden" id="oldfileaname" name="oldfileaname[]" value="'.$g.'"> '.$e.'<br>';if( $b!='' ){$sa.='檔案 - <a href="../../d.php?f='.$b.'&n='.urlencode($g).'">'.$g.'</a><br><font class="mouse_over" onclick="deleimg(\''.$a.'\');">刪除檔案</font>&nbsp;&nbsp;&nbsp;';}$sa.='<font class="mouse_over" onclick="document.cform1.mfile';if( $f!=='' ){$sa.='['.$f.']';}$sa.='.outerHTML=\'<input id=mfile name=mfile[] type=file>\';">取消上傳</font>';break;default:$sa='ERROR';break;}return $sa;}function up_file_photo( $a, $b, $c, $d, $e, $f, $g ,$h ){global $sys_set_type;global $message_str;global $upfilearray;$filenums=sizeof($d['name']);for($i=0;$i<$filenums;$i++){$f_name=$d['name'][$i];if( $f_name!='' ){if( $d['error'][$i]==0 ){if( in_array(strrchr($f_name,'.'),$sys_set_type[$h[$i]]) ){$f_size=$d['size'][$i];if( $f_size<=$g[$i] ){$f_tname=$d['tmp_name'][$i];if( is_uploaded_file($f_tname) ){$m_file=$c.'_'.$i.'_'.time().strrchr($f_name,'.');if( move_uploaded_file($f_tname,$a.$m_file) ){chmod($a.$m_file,0777);$upfilearray[$i]=array($f_name,$m_file,$f_size);}else{$message_str.=$b[$i].' - 上傳失敗\n\n';}}else{$message_str.=$b[$i].' - 上傳失敗\n\n';}}else{$message_str.=$b[$i].' - 檔案過大\n\n';}}else{$message_str.=$b[$i].' - 格式錯誤\n\n';}}else{$message_str.=$b[$i].' - 上傳失敗\n\n';}}}if( $message_str!='' ){$message_str='alert(\''.$message_str.'\')';}for($i=0;$i<$filenums;$i++){if( isset($upfilearray[$i]) && $upfilearray[$i]!=null && $upfilearray[$i]!='' ){@unlink($a.$e[$i]);}else{$upfilearray[$i]=array($f[$i],$e[$i],'');}}}
?>